# Configuration Guide

Complete guide to configuring PodSnips environment variables and settings.

## Table of Contents

- [Overview](#overview)
- [Backend Configuration](#backend-configuration)
- [Frontend Configuration](#frontend-configuration)
- [Notion Configuration](#notion-configuration)
- [Canva Configuration](#canva-configuration)

## Overview

PodSnips uses environment variables for configuration to keep sensitive credentials secure and allow different settings for development and production environments.

### Configuration Files

```
project-podsnips/
├── backend/
│   └── backend_app/
│       ├── .env              # Main backend config (DO NOT COMMIT)
│       └── .env.example      # Template with no values
└── frontend/
    └── vite.config.js        # Frontend build config
```

**Important:** Never commit `.env` files to version control. They contain sensitive credentials.

## Backend Configuration

### Main Backend Environment Variables

Location: `backend/backend_app/.env`

#### Required Variables

##### `NOTION_API_KEY`
- **Description:** Your Notion integration secret token
- **Type:** String
- **Required:** Yes
- **How to get:**
  1. Go to [https://www.notion.so/my-integrations](https://www.notion.so/my-integrations)
  2. Create a new integration
  3. Copy the "Internal Integration Token"
- **Example:** `secret_abc123def456...`
- **Used by:** Notion API client for authentication

##### `SOURCE_DATABASE_ID`
- **Description:** The ID of your Notion database containing podcast snips
- **Type:** String (32 characters, alphanumeric)
- **Required:** Yes
- **How to get:**
  - From database URL: `https://www.notion.so/workspace/{DATABASE_ID}?v=...`
  - Copy the 32-character string
- **Example:** `abc123def456789012345678901234ab`
- **Used by:** To fetch projects and tasks from the correct database

##### `CANVA_CLIENT_ID`
- **Description:** OAuth Client ID from your Canva app
- **Type:** String
- **Required:** Yes (for clip upload functionality)
- **How to get:**
  1. Go to [Canva Developers](https://www.canva.com/developers/)
  2. Create an integration
  3. Copy the Client ID
- **Example:** `OC-abc123_DEF456`
- **Used by:** OAuth authentication flow with Canva

##### `CANVA_CLIENT_SECRET`
- **Description:** OAuth Client Secret from your Canva app
- **Type:** String
- **Required:** Yes (for clip upload functionality)
- **How to get:** Same as Client ID (shown in app settings)
- **Example:** `abc123def456...`
- **Security:** Keep this secret! Never commit or share publicly
- **Used by:** OAuth token exchange

##### `CANVA_REDIRECT_URI`
- **Description:** OAuth callback URL for Canva authentication
- **Type:** URL
- **Required:** Yes
- **Value:** `http://localhost:8000/callback` (for local development)
- **Production:** Update to your production domain
- **Must match:** The redirect URI configured in your Canva app settings
- **Used by:** OAuth flow to receive authorization code


### Canva Token Storage

After running `make canva_auth`, OAuth tokens are stored in:

**Location:** `backend/canva_tokens.json`

**Contents:**
```json
{
  "access_token": "...",
  "refresh_token": "...",
  "expires_at": 1234567890,
  "token_type": "Bearer"
}
```

**Security:**
- This file is automatically generated
- Contains sensitive access tokens
- Should be in `.gitignore`
- Tokens expire and are automatically refreshed
- If authentication fails, delete this file and re-run `make canva_auth`

## Frontend Configuration

### Build Configuration

Location: `frontend/vite.config.js`

The frontend configuration is primarily in the Vite config file:

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,           // Dev server port
    host: 'localhost',    // Dev server host
    proxy: {
      '/api': {
        target: 'http://localhost:5000',  // Backend API URL
        changeOrigin: true,
      }
    }
  }
})
```

### API Configuration

Location: `frontend/src/services/api.js`

```javascript
import axios from 'axios';

const API_BASE_URL = 'http://localhost:5000/api/v1';

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,  // 30 second timeout
  headers: {
    'Content-Type': 'application/json',
  },
});

export default api;
```


## Notion Configuration

### Database Schema Requirements

Your Notion database must have these properties:

#### Required Properties

| Property Name | Type | Options | Description |
|--------------|------|---------|-------------|
| **Name/Title** | Title | - | Project/Episode name |
| **Status** | Select | Must include "Not started" | Project status |
| **Episode** | Text | - | Episode name or number |
| **Podcast Show** | Text | - | Podcast show name |

#### Optional Properties

You can add any additional properties for your needs. The application will ignore them.

### Database Permissions

The Notion integration needs these permissions:
- **Read content** - To fetch projects and tasks
- **Update content** - To update task status (if implemented)
- **Insert content** - To create new entries (if needed)

### Database Filtering

The API automatically filters projects by:
- Status equals "Not started"

Only projects matching this criteria are returned to the frontend.

## Canva Configuration

### OAuth Scopes

Your Canva app needs these scopes:

| Scope | Purpose |
|-------|---------|
| `asset:read` | Read uploaded assets |
| `asset:write` | Upload video files |
| `folder:read` | List folders |
| `folder:write` | Move assets to folders |

### Redirect URI Configuration

**Development:**
```
http://localhost:8000/callback
```

**Production:**
```
https://yourdomain.com/auth/canva/callback
```

**Important:** The redirect URI must exactly match in:
1. Your `.env` file (`CANVA_REDIRECT_URI`)
2. Your Canva app settings
3. The OAuth flow URL

### Canva Folder Structure

Videos are uploaded to Canva and can be organized into folders. The default behavior is to upload to the root folder. You can modify this in `backend_app/canva_upload_video.py`.


### Production Considerations

1. **Use environment variables instead of files**
   - Deploy platforms (Heroku, AWS, etc.) provide secure env var storage
   - Don't deploy `.env` files to production

2. **Use secrets management**
   - AWS Secrets Manager
   - HashiCorp Vault
   - Platform-specific secret stores

3. **Enable HTTPS**
   - Update Canva redirect URI to use `https://`
   - Configure SSL certificates

4. **Set proper CORS origins**
   - In `app.py`, restrict CORS to your frontend domain
   - Don't allow all origins (`*`) in production
